{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { HomeOutlined, LikeOutlined } from '@ant-design/icons-vue';\nimport { jumphelper } from \"@/js/jumphelper\";\nimport { onMounted, ref } from \"vue\";\nimport { likeSpaceApi, postLog, selectSpaceApi } from \"@/js/apihelper\";\nimport { timeCorrect } from \"@/js/jshelper\";\nimport { message } from \"ant-design-vue\";\nimport { bus } from \"vue3-eventbus\";\nimport ImgCom from \"@/coms/all/ImgCom.vue\";\nexport default {\n  __name: 'DesktopMySpace',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    onMounted(() => {\n      getSpace();\n      getLikedData();\n      message.info('欢迎访问我的空间:D');\n    });\n    const currentParams = ref({\n      startIndex: 0,\n      length: 4\n    });\n    const spaces = ref([]);\n    const getSpace = () => {\n      const getResult = selectSpaceApi(currentParams.value);\n      getResult.then(response => {\n        for (const tmpSpace of response.data) {\n          tmpSpace.spaceTime = timeCorrect(tmpSpace.spaceTime);\n        }\n        if (response.data.length > 0) {\n          spaces.value = spaces.value.concat(response.data);\n        } else {\n          message.warn('后面没有了，更早的请看旧版于眉顶部“我的空间”');\n        }\n      }).catch(e => {\n        console.log(e);\n        message.error('未知错误');\n      });\n    };\n    const showSpaceImg = imgUrl => {\n      bus.emit('showImg', imgUrl);\n    };\n    const downloadFile = (spaceIndex, fileIndex) => {\n      const fileUrl = spaces.value[spaceIndex].spaceFiles[fileIndex];\n      window.location.href = fileUrl;\n    };\n    const likeSpace = (spaceId, spaceIndex) => {\n      if (beforeLike(spaceId)) {\n        const postResult = likeSpaceApi(spaceId);\n        postResult.then(response => {\n          if (response.data) {\n            saveLikedData();\n            message.success('谢谢喜欢:D');\n            postLog('空间点赞，spaceId为' + spaceId);\n            spaces.value[spaceIndex].likeNum += 1;\n          } else {\n            message.error('点赞失败');\n          }\n        }).catch(e => {\n          message.error('未知错误');\n          console.log(e);\n        });\n      } else {\n        message.warn('每天只能给每条说说点10个赞');\n      }\n    };\n    const getMore = () => {\n      currentParams.value.startIndex += currentParams.value.length;\n      getSpace();\n    };\n    const likedData = ref([]);\n    const getLikedData = () => {\n      if (localStorage.getItem('likedData')) {\n        likedData.value = JSON.parse(localStorage.getItem('likedData'));\n      } else {\n        localStorage.setItem('likedData', '[]');\n        likedData.value = JSON.parse(localStorage.getItem('likedData'));\n      }\n    };\n    const saveLikedData = () => {\n      const likedDataString = JSON.stringify(likedData.value);\n      localStorage.setItem('likedData', likedDataString);\n    };\n    const beforeLike = spaceId => {\n      const filteredArray = likedData.value.filter(item => item.spaceId === spaceId);\n      console.log(filteredArray);\n      if (filteredArray.length > 0) {\n        for (const filteredArrayElement of filteredArray) {\n          if (filteredArrayElement.time === getNowTime() && filteredArrayElement.num >= 10) {\n            return false;\n          } else if (filteredArrayElement.time !== getNowTime()) {\n            filteredArrayElement.time = getNowTime();\n            filteredArrayElement.num = 1;\n            return true;\n          } else {\n            filteredArrayElement.num += 1;\n            return true;\n          }\n        }\n      } else {\n        likedData.value.push({\n          spaceId: spaceId,\n          userId: localStorage.getItem('UUID'),\n          time: getNowTime(),\n          num: 1\n        });\n        return true;\n      }\n      return false;\n    };\n    const getNowTime = () => {\n      const date = new Date();\n      const year = date.getFullYear();\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const day = String(date.getDate()).padStart(2, '0');\n      const nowTime = `${year}-${month}-${day}`;\n      return nowTime;\n    };\n    const __returned__ = {\n      currentParams,\n      spaces,\n      getSpace,\n      showSpaceImg,\n      downloadFile,\n      likeSpace,\n      getMore,\n      likedData,\n      getLikedData,\n      saveLikedData,\n      beforeLike,\n      getNowTime,\n      get HomeOutlined() {\n        return HomeOutlined;\n      },\n      get LikeOutlined() {\n        return LikeOutlined;\n      },\n      get jumphelper() {\n        return jumphelper;\n      },\n      onMounted,\n      ref,\n      get likeSpaceApi() {\n        return likeSpaceApi;\n      },\n      get postLog() {\n        return postLog;\n      },\n      get selectSpaceApi() {\n        return selectSpaceApi;\n      },\n      get timeCorrect() {\n        return timeCorrect;\n      },\n      get message() {\n        return message;\n      },\n      get bus() {\n        return bus;\n      },\n      ImgCom\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["HomeOutlined","LikeOutlined","jumphelper","onMounted","ref","likeSpaceApi","postLog","selectSpaceApi","timeCorrect","message","bus","ImgCom","getSpace","getLikedData","info","currentParams","startIndex","length","spaces","getResult","value","then","response","tmpSpace","data","spaceTime","concat","warn","catch","e","console","log","error","showSpaceImg","imgUrl","emit","downloadFile","spaceIndex","fileIndex","fileUrl","spaceFiles","window","location","href","likeSpace","spaceId","beforeLike","postResult","saveLikedData","success","likeNum","getMore","likedData","localStorage","getItem","JSON","parse","setItem","likedDataString","stringify","filteredArray","filter","item","filteredArrayElement","time","getNowTime","num","push","userId","date","Date","year","getFullYear","month","String","getMonth","padStart","day","getDate","nowTime"],"sources":["/Users/ayden/Desktop/FiveCheersBlog/fcweb/src/pages/myspace/DesktopMySpace.vue"],"sourcesContent":["<script setup>\nimport {\n  HomeOutlined, LikeOutlined,\n} from '@ant-design/icons-vue';\nimport {jumphelper} from \"@/js/jumphelper\";\nimport {onMounted, ref} from \"vue\";\nimport {likeSpaceApi, postLog, selectSpaceApi} from \"@/js/apihelper\";\nimport {timeCorrect} from \"@/js/jshelper\";\nimport {message} from \"ant-design-vue\";\nimport {bus} from \"vue3-eventbus\";\nimport ImgCom from \"@/coms/all/ImgCom.vue\";\nonMounted(()=>{\n  getSpace()\n  getLikedData()\n  message.info('欢迎访问我的空间:D')\n})\nconst currentParams = ref({\n  startIndex: 0,\n  length: 4,\n})\nconst spaces = ref([])\nconst getSpace = ()=>{\n  const getResult = selectSpaceApi(currentParams.value)\n  getResult.then(response=>{\n    for (const tmpSpace of response.data) {\n      tmpSpace.spaceTime = timeCorrect(tmpSpace.spaceTime)\n    }\n    if (response.data.length>0){\n      spaces.value = spaces.value.concat(response.data)\n    }else{\n      message.warn('后面没有了，更早的请看旧版于眉顶部“我的空间”')\n    }\n\n  }).catch(e=>{\n    console.log(e)\n    message.error('未知错误')\n  })\n}\nconst showSpaceImg = (imgUrl)=>{\n  bus.emit('showImg',imgUrl)\n}\nconst downloadFile = (spaceIndex, fileIndex)=>{\n  const fileUrl = spaces.value[spaceIndex].spaceFiles[fileIndex]\n  window.location.href = fileUrl\n}\nconst likeSpace = (spaceId, spaceIndex)=>{\n  if (beforeLike(spaceId)){\n    const postResult = likeSpaceApi(spaceId)\n    postResult.then(response=>{\n      if (response.data){\n        saveLikedData()\n        message.success('谢谢喜欢:D')\n        postLog('空间点赞，spaceId为'+spaceId)\n        spaces.value[spaceIndex].likeNum += 1\n      }else {\n        message.error('点赞失败')\n      }\n    }).catch(e=>{\n      message.error('未知错误')\n      console.log(e)\n    })\n  }else{\n    message.warn('每天只能给每条说说点10个赞')\n  }\n\n}\nconst getMore = ()=>{\n  currentParams.value.startIndex += currentParams.value.length;\n  getSpace()\n}\n\nconst likedData = ref([])\nconst getLikedData = ()=>{\n  if (localStorage.getItem('likedData')){\n    likedData.value = JSON.parse(localStorage.getItem('likedData'))\n  }else{\n    localStorage.setItem('likedData','[]')\n    likedData.value = JSON.parse(localStorage.getItem('likedData'))\n  }\n}\nconst saveLikedData = ()=>{\n  const likedDataString = JSON.stringify(likedData.value)\n  localStorage.setItem('likedData', likedDataString)\n}\nconst beforeLike = (spaceId)=>{\n  const filteredArray = likedData.value.filter(item => item.spaceId === spaceId);\n  console.log(filteredArray)\n  if (filteredArray.length>0){\n    for (const filteredArrayElement of filteredArray) {\n      if (filteredArrayElement.time === getNowTime() && filteredArrayElement.num >= 10){\n        return false\n      }else if (filteredArrayElement.time !== getNowTime()){\n        filteredArrayElement.time = getNowTime()\n        filteredArrayElement.num = 1\n        return true\n      }else{\n        filteredArrayElement.num += 1\n        return true\n      }\n    }\n  }else{\n    likedData.value.push({\n      spaceId: spaceId,\n      userId: localStorage.getItem('UUID'),\n      time: getNowTime(),\n      num: 1\n    })\n    return true\n  }\n  return false\n}\nconst getNowTime = ()=>{\n  const date = new Date()\n  const year = date.getFullYear()\n  const month = String(date.getMonth() + 1).padStart(2,'0')\n  const day = String(date.getDate()).padStart(2, '0')\n  const nowTime = `${year}-${month}-${day}`\n  return nowTime\n}\n\n\n</script>\n\n<template>\n  <div class=\"space_background\">\n    <HomeOutlined @click=\"jumphelper.jumpToSelect()\" class=\"home_icon\"/>\n    <div>\n      <div v-for=\"(space, spaceIndex) in spaces\" :key=\"spaceIndex\" class=\"space_line\">\n        <!--背景-->\n        <div class=\"space-line-background\">\n          <img src=\"@/assets/bk.png\" alt=\"\">\n          <img :src=\"space.spaceImgs[0]\">\n          <div></div>\n        </div>\n        <!--时间-->\n        <div class=\"time_container\">\n          <h3>{{ space.spaceTime }}</h3>\n        </div>\n        <!--内容-->\n        <div class=\"content_container\">\n          <p>{{ space.spaceContent }}</p>\n          <div v-if=\"space.spaceImgs[0] !== ''\" class=\"imgs_container\">\n            <div v-for=\"(item, imgIndex) in space.spaceImgs\" :key=\"imgIndex\">\n              <img @click=\"showSpaceImg(item)\" :src=\"item\" alt=\"\">\n            </div>\n          </div>\n          <div v-if=\"space.spaceFiles[0] !== ''\" class=\"files_container\">\n            <div v-for=\"(item, fileIndex) in space.spaceFiles\" :key=\"fileIndex\">\n              <a-button @click=\"downloadFile(spaceIndex, fileIndex)\">点击下载文件 {{fileIndex + 1}} </a-button>\n            </div>\n          </div>\n          <div class=\"like_container\">\n            <LikeOutlined class=\"like\" @click=\"likeSpace(space.spaceId, spaceIndex)\"/>\n            {{ space.likeNum }}\n          </div>\n        </div>\n      </div>\n      <!--查看更多-->\n      <div class=\"btn_container\">\n        <a-button style=\"font-family: 夏风\" type=\"text\" @click=\"getMore\">- 查看更多 -</a-button>\n      </div>\n    </div>\n    <ImgCom/>\n  </div>\n</template>\n\n<style scoped>\n  .space_background{\n    background: linear-gradient(to right bottom, #fdfdfd, #f3f6fc);\n    overflow-y: scroll;\n    overflow-x: hidden;\n  }\n  .space_line{\n    display: flex;\n    align-items: flex-start;\n    justify-content: space-between;\n    margin: 0 52px;\n    height: auto;\n    position: relative;\n  }\n  .space_line .space-line-background{\n    z-index: -1;\n    position: absolute;\n    width: calc(100% + 104px);\n    left: -52px;\n    top: 50%;\n    transform: translateY(-50%);\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    overflow: hidden\n  }\n  .space_line .space-line-background img{\n    position: absolute;\n    object-fit: cover;\n    min-height: 100%;\n    min-width: 100%;\n  }\n  .space_line .space-line-background div{\n    position: absolute;\n    height: 100%;\n    width: 100%;\n    background-color: #E7E1E188;\n    backdrop-filter: blur(4px);\n  }\n  .time_container{\n    width: 128px;\n    text-align: right;\n    line-height: 28px;\n    padding-right: 12px;\n    letter-spacing: 2px;\n    font-family: 清泉;\n    margin-top: 4px;\n    animation: right-fade-in 1s 1;\n  }\n  .content_container{\n    flex: 1;\n    position: relative;\n    border-left: #6767dc 2px solid;\n    min-height: 80px;\n    padding: 12px 0 32px 12px;\n    animation: top-fade-in 1s 1;\n    white-space: pre-line;\n  }\n  .content_container p{\n    padding: 0 0 0 8px;\n  }\n  .imgs_container{\n    display: flex;\n    flex-wrap: wrap;\n  }\n  .imgs_container div{\n    min-width: 200px;\n    min-height: 150px;\n    width: calc(32vw - 100px);\n    height: calc(24vw - 75px);\n    overflow: hidden;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    position: relative;\n    margin: 8px;\n    box-shadow: 0 0 4px #00000011;\n    border-radius: 4px;\n    transition: .4s;\n  }\n  .imgs_container img{\n    min-width: 100%;\n    min-height: 100%;\n    object-fit: cover;\n    cursor: pointer;\n    box-shadow: 2px 2px 8px #00000044;\n  }\n  .imgs_container div:hover{\n    box-shadow: 0 0 8px #00000022;\n    transition: .4s;\n  }\n  .files_container{\n    display: flex;\n    flex-wrap: wrap;\n  }\n  .files_container button{\n    margin: 4px 0 12px 8px;\n  }\n  .like_container{\n    margin: 0 8px 0 8px;\n    text-align: right;\n  }\n  .like{\n    transition: .2s;\n  }\n  .like:active{\n    transition: .2s;\n    transform: scale(1.2);\n  }\n  .btn_container{\n    margin-bottom: 12px;\n    display: flex;\n    align-items: center;\n    justify-content: space-around;\n    background: linear-gradient(to bottom, #f2efef, #fff);\n  }\n\n\n\n</style>\n"],"mappings":";AACA,SACEA,YAAY,EAAEC,YAAY,QACrB,uBAAuB;AAC9B,SAAQC,UAAU,QAAO,iBAAiB;AAC1C,SAAQC,SAAS,EAAEC,GAAG,QAAO,KAAK;AAClC,SAAQC,YAAY,EAAEC,OAAO,EAAEC,cAAc,QAAO,gBAAgB;AACpE,SAAQC,WAAW,QAAO,eAAe;AACzC,SAAQC,OAAO,QAAO,gBAAgB;AACtC,SAAQC,GAAG,QAAO,eAAe;AACjC,OAAOC,MAAM,MAAM,uBAAuB;;;;;;;IAC1CR,SAAS,CAAC,MAAI;MACZS,QAAQ,CAAC,CAAC;MACVC,YAAY,CAAC,CAAC;MACdJ,OAAO,CAACK,IAAI,CAAC,YAAY,CAAC;IAC5B,CAAC,CAAC;IACF,MAAMC,aAAa,GAAGX,GAAG,CAAC;MACxBY,UAAU,EAAE,CAAC;MACbC,MAAM,EAAE;IACV,CAAC,CAAC;IACF,MAAMC,MAAM,GAAGd,GAAG,CAAC,EAAE,CAAC;IACtB,MAAMQ,QAAQ,GAAGA,CAAA,KAAI;MACnB,MAAMO,SAAS,GAAGZ,cAAc,CAACQ,aAAa,CAACK,KAAK,CAAC;MACrDD,SAAS,CAACE,IAAI,CAACC,QAAQ,IAAE;QACvB,KAAK,MAAMC,QAAQ,IAAID,QAAQ,CAACE,IAAI,EAAE;UACpCD,QAAQ,CAACE,SAAS,GAAGjB,WAAW,CAACe,QAAQ,CAACE,SAAS,CAAC;QACtD;QACA,IAAIH,QAAQ,CAACE,IAAI,CAACP,MAAM,GAAC,CAAC,EAAC;UACzBC,MAAM,CAACE,KAAK,GAAGF,MAAM,CAACE,KAAK,CAACM,MAAM,CAACJ,QAAQ,CAACE,IAAI,CAAC;QACnD,CAAC,MAAI;UACHf,OAAO,CAACkB,IAAI,CAAC,yBAAyB,CAAC;QACzC;MAEF,CAAC,CAAC,CAACC,KAAK,CAACC,CAAC,IAAE;QACVC,OAAO,CAACC,GAAG,CAACF,CAAC,CAAC;QACdpB,OAAO,CAACuB,KAAK,CAAC,MAAM,CAAC;MACvB,CAAC,CAAC;IACJ,CAAC;IACD,MAAMC,YAAY,GAAIC,MAAM,IAAG;MAC7BxB,GAAG,CAACyB,IAAI,CAAC,SAAS,EAACD,MAAM,CAAC;IAC5B,CAAC;IACD,MAAME,YAAY,GAAGA,CAACC,UAAU,EAAEC,SAAS,KAAG;MAC5C,MAAMC,OAAO,GAAGrB,MAAM,CAACE,KAAK,CAACiB,UAAU,CAAC,CAACG,UAAU,CAACF,SAAS,CAAC;MAC9DG,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAGJ,OAAO;IAChC,CAAC;IACD,MAAMK,SAAS,GAAGA,CAACC,OAAO,EAAER,UAAU,KAAG;MACvC,IAAIS,UAAU,CAACD,OAAO,CAAC,EAAC;QACtB,MAAME,UAAU,GAAG1C,YAAY,CAACwC,OAAO,CAAC;QACxCE,UAAU,CAAC1B,IAAI,CAACC,QAAQ,IAAE;UACxB,IAAIA,QAAQ,CAACE,IAAI,EAAC;YAChBwB,aAAa,CAAC,CAAC;YACfvC,OAAO,CAACwC,OAAO,CAAC,QAAQ,CAAC;YACzB3C,OAAO,CAAC,eAAe,GAACuC,OAAO,CAAC;YAChC3B,MAAM,CAACE,KAAK,CAACiB,UAAU,CAAC,CAACa,OAAO,IAAI,CAAC;UACvC,CAAC,MAAK;YACJzC,OAAO,CAACuB,KAAK,CAAC,MAAM,CAAC;UACvB;QACF,CAAC,CAAC,CAACJ,KAAK,CAACC,CAAC,IAAE;UACVpB,OAAO,CAACuB,KAAK,CAAC,MAAM,CAAC;UACrBF,OAAO,CAACC,GAAG,CAACF,CAAC,CAAC;QAChB,CAAC,CAAC;MACJ,CAAC,MAAI;QACHpB,OAAO,CAACkB,IAAI,CAAC,gBAAgB,CAAC;MAChC;IAEF,CAAC;IACD,MAAMwB,OAAO,GAAGA,CAAA,KAAI;MAClBpC,aAAa,CAACK,KAAK,CAACJ,UAAU,IAAID,aAAa,CAACK,KAAK,CAACH,MAAM;MAC5DL,QAAQ,CAAC,CAAC;IACZ,CAAC;IAED,MAAMwC,SAAS,GAAGhD,GAAG,CAAC,EAAE,CAAC;IACzB,MAAMS,YAAY,GAAGA,CAAA,KAAI;MACvB,IAAIwC,YAAY,CAACC,OAAO,CAAC,WAAW,CAAC,EAAC;QACpCF,SAAS,CAAChC,KAAK,GAAGmC,IAAI,CAACC,KAAK,CAACH,YAAY,CAACC,OAAO,CAAC,WAAW,CAAC,CAAC;MACjE,CAAC,MAAI;QACHD,YAAY,CAACI,OAAO,CAAC,WAAW,EAAC,IAAI,CAAC;QACtCL,SAAS,CAAChC,KAAK,GAAGmC,IAAI,CAACC,KAAK,CAACH,YAAY,CAACC,OAAO,CAAC,WAAW,CAAC,CAAC;MACjE;IACF,CAAC;IACD,MAAMN,aAAa,GAAGA,CAAA,KAAI;MACxB,MAAMU,eAAe,GAAGH,IAAI,CAACI,SAAS,CAACP,SAAS,CAAChC,KAAK,CAAC;MACvDiC,YAAY,CAACI,OAAO,CAAC,WAAW,EAAEC,eAAe,CAAC;IACpD,CAAC;IACD,MAAMZ,UAAU,GAAID,OAAO,IAAG;MAC5B,MAAMe,aAAa,GAAGR,SAAS,CAAChC,KAAK,CAACyC,MAAM,CAACC,IAAI,IAAIA,IAAI,CAACjB,OAAO,KAAKA,OAAO,CAAC;MAC9Ef,OAAO,CAACC,GAAG,CAAC6B,aAAa,CAAC;MAC1B,IAAIA,aAAa,CAAC3C,MAAM,GAAC,CAAC,EAAC;QACzB,KAAK,MAAM8C,oBAAoB,IAAIH,aAAa,EAAE;UAChD,IAAIG,oBAAoB,CAACC,IAAI,KAAKC,UAAU,CAAC,CAAC,IAAIF,oBAAoB,CAACG,GAAG,IAAI,EAAE,EAAC;YAC/E,OAAO,KAAK;UACd,CAAC,MAAK,IAAIH,oBAAoB,CAACC,IAAI,KAAKC,UAAU,CAAC,CAAC,EAAC;YACnDF,oBAAoB,CAACC,IAAI,GAAGC,UAAU,CAAC,CAAC;YACxCF,oBAAoB,CAACG,GAAG,GAAG,CAAC;YAC5B,OAAO,IAAI;UACb,CAAC,MAAI;YACHH,oBAAoB,CAACG,GAAG,IAAI,CAAC;YAC7B,OAAO,IAAI;UACb;QACF;MACF,CAAC,MAAI;QACHd,SAAS,CAAChC,KAAK,CAAC+C,IAAI,CAAC;UACnBtB,OAAO,EAAEA,OAAO;UAChBuB,MAAM,EAAEf,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC;UACpCU,IAAI,EAAEC,UAAU,CAAC,CAAC;UAClBC,GAAG,EAAE;QACP,CAAC,CAAC;QACF,OAAO,IAAI;MACb;MACA,OAAO,KAAK;IACd,CAAC;IACD,MAAMD,UAAU,GAAGA,CAAA,KAAI;MACrB,MAAMI,IAAI,GAAG,IAAIC,IAAI,CAAC,CAAC;MACvB,MAAMC,IAAI,GAAGF,IAAI,CAACG,WAAW,CAAC,CAAC;MAC/B,MAAMC,KAAK,GAAGC,MAAM,CAACL,IAAI,CAACM,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,EAAC,GAAG,CAAC;MACzD,MAAMC,GAAG,GAAGH,MAAM,CAACL,IAAI,CAACS,OAAO,CAAC,CAAC,CAAC,CAACF,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC;MACnD,MAAMG,OAAO,GAAI,GAAER,IAAK,IAAGE,KAAM,IAAGI,GAAI,EAAC;MACzC,OAAOE,OAAO;IAChB,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}