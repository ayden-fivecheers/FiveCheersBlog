{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { CloseOutlined, UploadOutlined } from '@ant-design/icons-vue';\nimport { bus } from \"vue3-eventbus\";\nimport { onMounted, ref } from \"vue\";\nimport { deleteSpaceApi, selectSpaceApi, updateSpaceApi } from \"@/js/apihelper\";\nimport { message } from \"ant-design-vue\";\nimport { timeCorrect } from \"@/js/jshelper\";\nexport default {\n  __name: 'SpaceUpdateCom',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const closeSelectCard = () => {\n      bus.emit('closeSelectCard');\n    };\n    onMounted(() => {\n      getSpace();\n    });\n    const currentParams = ref({\n      startIndex: 0,\n      length: 4\n    });\n    const spaces = ref([]);\n    const getSpace = () => {\n      const getResult = selectSpaceApi(currentParams.value);\n      getResult.then(response => {\n        for (const tmpSpace of response.data) {\n          tmpSpace.spaceTime = timeCorrect(tmpSpace.spaceTime);\n        }\n        spaces.value = spaces.value.concat(response.data);\n      }).catch(e => {\n        console.log(e);\n        message.error('未知错误');\n      });\n    };\n    const getMore = () => {\n      currentParams.value.startIndex += currentParams.value.length;\n      getSpace();\n    };\n    //一条\n    const deleteImg = (spaceIndex, imgIndex) => {\n      spaces.value[spaceIndex].spaceImgs.splice(imgIndex, 1);\n    };\n    const handleUploadImgChange = info => {\n      if (info.file.status === 'done') {\n        message.success(`文件上传成功，img值已更改`);\n        spaces.value[currentUploadImgIndex.value].spaceImgs.push(info.file.response);\n      } else if (info.file.status === 'error') {\n        message.error(`${info.file.name} 文件上传失败`);\n      }\n    };\n    const currentUploadImgIndex = ref(null);\n    const changeCurrentUploadImgIndex = spaceIndex => {\n      currentUploadImgIndex.value = spaceIndex;\n    };\n    const deleteFile = (spaceIndex, fileIndex) => {\n      spaces.value[spaceIndex].spaceFiles.splice(fileIndex, 1);\n    };\n    const handleUploadFileChange = info => {\n      if (info.file.status === 'done') {\n        message.success(`文件上传成功，file值已更改`);\n        spaces.value[currentUploadFileIndex.value].spaceFiles.push(info.file.response);\n      } else if (info.file.status === 'error') {\n        message.error(`${info.file.name} 文件上传失败`);\n      }\n    };\n    const currentUploadFileIndex = ref(null);\n    const changeCurrentUploadFileIndex = spaceIndex => {\n      currentUploadFileIndex.value = spaceIndex;\n    };\n    const updateSpace = spaceIndex => {\n      const tmpSpace = JSON.parse(JSON.stringify(spaces.value[spaceIndex]));\n      tmpSpace.spaceTime = null;\n      const postResult = updateSpaceApi(tmpSpace);\n      postResult.then(response => {\n        if (response.data) {\n          message.success('更改成功');\n        } else {\n          message.error('更改失败');\n        }\n      }).catch(e => {\n        console.log(e);\n        message.error('未知错误');\n      });\n    };\n    const deleteSpace = spaceIndex => {\n      const spaceId = spaces.value[spaceIndex].spaceId;\n      const postResult = deleteSpaceApi(spaceId);\n      postResult.then(response => {\n        if (response.data) {\n          message.success('删除成功');\n          spaces.value.splice(spaceIndex, 1);\n        } else {\n          message.error('删除失败');\n        }\n      }).catch(e => {\n        console.log(e);\n        message.error('未知错误');\n      });\n    };\n    const downloadFile = (spaceIndex, fileIndex) => {\n      const fileUrl = spaces.value[spaceIndex].spaceFiles[fileIndex];\n      window.location.href = fileUrl;\n    };\n    const __returned__ = {\n      closeSelectCard,\n      currentParams,\n      spaces,\n      getSpace,\n      getMore,\n      deleteImg,\n      handleUploadImgChange,\n      currentUploadImgIndex,\n      changeCurrentUploadImgIndex,\n      deleteFile,\n      handleUploadFileChange,\n      currentUploadFileIndex,\n      changeCurrentUploadFileIndex,\n      updateSpace,\n      deleteSpace,\n      downloadFile,\n      get CloseOutlined() {\n        return CloseOutlined;\n      },\n      get UploadOutlined() {\n        return UploadOutlined;\n      },\n      get bus() {\n        return bus;\n      },\n      onMounted,\n      ref,\n      get deleteSpaceApi() {\n        return deleteSpaceApi;\n      },\n      get selectSpaceApi() {\n        return selectSpaceApi;\n      },\n      get updateSpaceApi() {\n        return updateSpaceApi;\n      },\n      get message() {\n        return message;\n      },\n      get timeCorrect() {\n        return timeCorrect;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["CloseOutlined","UploadOutlined","bus","onMounted","ref","deleteSpaceApi","selectSpaceApi","updateSpaceApi","message","timeCorrect","closeSelectCard","emit","getSpace","currentParams","startIndex","length","spaces","getResult","value","then","response","tmpSpace","data","spaceTime","concat","catch","e","console","log","error","getMore","deleteImg","spaceIndex","imgIndex","spaceImgs","splice","handleUploadImgChange","info","file","status","success","currentUploadImgIndex","push","name","changeCurrentUploadImgIndex","deleteFile","fileIndex","spaceFiles","handleUploadFileChange","currentUploadFileIndex","changeCurrentUploadFileIndex","updateSpace","JSON","parse","stringify","postResult","deleteSpace","spaceId","downloadFile","fileUrl","window","location","href"],"sources":["/Users/ayden/Desktop/FiveCheersBlog/fcweb/src/coms/manager/SpaceUpdateCom.vue"],"sourcesContent":["<script setup>\nimport {CloseOutlined, UploadOutlined} from '@ant-design/icons-vue'\nimport {bus} from \"vue3-eventbus\";\nimport {onMounted, ref} from \"vue\";\nimport {deleteSpaceApi, selectSpaceApi, updateSpaceApi} from \"@/js/apihelper\";\nimport {message} from \"ant-design-vue\";\nimport {timeCorrect} from \"@/js/jshelper\";\n\nconst closeSelectCard = ()=>{\n  bus.emit('closeSelectCard')\n}\nonMounted(()=>{\n  getSpace()\n})\nconst currentParams = ref({\n  startIndex: 0,\n  length: 4,\n})\nconst spaces = ref([])\nconst getSpace = ()=>{\n  const getResult = selectSpaceApi(currentParams.value)\n  getResult.then(response=>{\n    for (const tmpSpace of response.data) {\n      tmpSpace.spaceTime = timeCorrect(tmpSpace.spaceTime)\n    }\n    spaces.value = spaces.value.concat(response.data)\n  }).catch(e=>{\n    console.log(e)\n    message.error('未知错误')\n  })\n}\nconst getMore = ()=>{\n  currentParams.value.startIndex += currentParams.value.length;\n  getSpace()\n}\n//一条\nconst deleteImg = (spaceIndex, imgIndex)=>{\n  spaces.value[spaceIndex].spaceImgs.splice(imgIndex, 1)\n}\nconst handleUploadImgChange = (info)=>{\n  if (info.file.status === 'done') {\n    message.success(`文件上传成功，img值已更改`);\n    spaces.value[currentUploadImgIndex.value].spaceImgs.push(info.file.response)\n  } else if (info.file.status === 'error') {\n    message.error(`${info.file.name} 文件上传失败`);\n  }\n}\nconst currentUploadImgIndex = ref(null)\nconst changeCurrentUploadImgIndex = (spaceIndex)=>{\n  currentUploadImgIndex.value = spaceIndex\n}\nconst deleteFile = (spaceIndex, fileIndex)=>{\n  spaces.value[spaceIndex].spaceFiles.splice(fileIndex, 1)\n}\nconst handleUploadFileChange = (info)=>{\n  if (info.file.status === 'done') {\n    message.success(`文件上传成功，file值已更改`);\n    spaces.value[currentUploadFileIndex.value].spaceFiles.push(info.file.response)\n  } else if (info.file.status === 'error') {\n    message.error(`${info.file.name} 文件上传失败`);\n  }\n}\nconst currentUploadFileIndex = ref(null)\nconst changeCurrentUploadFileIndex = (spaceIndex)=>{\n  currentUploadFileIndex.value = spaceIndex\n}\nconst updateSpace = (spaceIndex)=>{\n  const tmpSpace = JSON.parse(JSON.stringify(spaces.value[spaceIndex]));\n  tmpSpace.spaceTime = null;\n  const postResult = updateSpaceApi(tmpSpace)\n  postResult.then(response=>{\n    if (response.data){\n      message.success('更改成功')\n    }else{\n      message.error('更改失败')\n    }\n  }).catch(e=>{\n    console.log(e)\n    message.error('未知错误')\n  })\n}\nconst deleteSpace = (spaceIndex)=>{\n  const spaceId = spaces.value[spaceIndex].spaceId\n  const postResult = deleteSpaceApi(spaceId)\n  postResult.then(response=>{\n    if (response.data){\n      message.success('删除成功')\n      spaces.value.splice(spaceIndex, 1)\n    }else{\n      message.error('删除失败')\n    }\n  }).catch(e=>{\n    console.log(e)\n    message.error('未知错误')\n  })\n}\nconst downloadFile = (spaceIndex, fileIndex)=>{\n  const fileUrl = spaces.value[spaceIndex].spaceFiles[fileIndex]\n  window.location.href = fileUrl\n}\n\n</script>\n\n<template>\n  <div class=\"select_com_background\">\n    <CloseOutlined @click=\"closeSelectCard()\" class=\"card_cancel_btn\" />\n    <h2>- 编辑说说 -</h2>\n    <div class=\"select_com_card\">\n      <div v-for=\"(space, spaceIndex) in spaces\" :key=\"spaceIndex\" class=\"space_line\">\n        <h4>{{ space.spaceTime }}</h4>\n        <a-textarea :auto-size=\"{ minRows: 2, maxRows: 99 }\" v-model:value=\"space.spaceContent\"/>\n        <!--图片-->\n        <h5>图片</h5>\n        <div v-if=\"space.spaceImgs[0] !== ''\" class=\"imgs_container\">\n          <div v-for=\"(item, imgIndex) in space.spaceImgs\" :key=\"imgIndex\">\n            <div style=\"position: absolute; left: 0; right: 0; top: 0; bottom: 0; background-color: #aaaaaa11\"></div>\n            <CloseOutlined @click=\"deleteImg(spaceIndex, imgIndex)\" style=\"position: absolute; right: 8px; top: 8px\"/>\n            <img :src=\"item\" alt=\"\">\n          </div>\n        </div>\n        <a-upload\n            action=\"https://www.yym-free.com/wz/file/defaultUpLoadFile\"\n            @change=\"handleUploadImgChange\">\n          <a-button @click=\"changeCurrentUploadImgIndex(spaceIndex)\" style=\"margin-top: 8px\">\n            <upload-outlined></upload-outlined>\n            上传图片\n          </a-button>\n        </a-upload>\n        <!--文件-->\n        <h5>文件</h5>\n        <div v-if=\"space.spaceFiles[0] !== ''\" class=\"files_container\">\n          <div v-for=\"(item, fileIndex) in space.spaceFiles\" :key=\"fileIndex\">\n            <a-button @click=\"downloadFile(spaceIndex, fileIndex)\">点击下载</a-button>\n            <CloseOutlined @click=\"deleteFile(spaceIndex, fileIndex)\"/>\n          </div>\n        </div>\n        <a-upload\n            action=\"https://www.yym-free.com/wz/file/defaultUpLoadFile\"\n            @change=\"handleUploadFileChange\">\n          <a-button @click=\"changeCurrentUploadFileIndex(spaceIndex)\" style=\"margin-top: 8px\">\n            <upload-outlined></upload-outlined>\n            上传文件\n          </a-button>\n        </a-upload>\n        <!--按钮-->\n        <div class=\"btn_container\">\n          <a-button type=\"primary\" @click=\"updateSpace(spaceIndex)\">确定</a-button>\n          <a-button type=\"primary\" danger @click=\"deleteSpace(spaceIndex)\">删除</a-button>\n        </div>\n        <a-divider/>\n      </div>\n      <!--查看更多-->\n      <div class=\"btn_container\">\n        <a-button type=\"text\" @click=\"getMore\">查看更多</a-button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n.select_com_background{\n  position: fixed;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  background: #00000044;\n  animation: fade-in .5s 1;\n}\n.select_com_background h2{\n  position: absolute;\n  top: calc(25vh - 145px);\n  left: 50%;\n  transform: translateX(-50%);\n  color: white;\n  letter-spacing: 6px;\n  font-size: 20px;\n  white-space: nowrap;\n}\n.select_com_card{\n  position: absolute;\n  left: 16px;\n  right: 16px;\n  top: 50%;\n  transform: translateY(-50%);\n  max-height: 580px;\n  height: calc(100% - 88px);\n  background: #fff;\n  border-radius: 8px;\n  padding: 16px 12px;\n  overflow-y: scroll;\n  overflow-x: hidden;\n}\n.space_line h4{\n  margin: 8px;\n  letter-spacing: 2px;\n  font-weight: bold;\n}\n.space_line h5{\n  margin: 12px 8px 4px 8px;\n  letter-spacing: 2px;\n  font-weight: bold;\n}\n.imgs_container{\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: space-around;\n  margin-top: 12px;\n}\n.imgs_container div{\n  width: 36vw;\n  height: 36vw;\n  overflow: hidden;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  position: relative;\n  margin: 8px;\n}\n.imgs_container img{\n  min-width: 100%;\n  min-height: 100%;\n  object-fit: cover;\n}\n.files_container div{\n  margin: 8px 0;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n}\n.btn_container{\n  margin-top: 16px;\n  display: flex;\n  align-items: center;\n  justify-content: space-around;\n}\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}