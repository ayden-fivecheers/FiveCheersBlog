{"ast":null,"code":"import { CloseOutlined, LeftOutlined, RightOutlined, UploadOutlined } from '@ant-design/icons-vue';\nimport { bus } from \"vue3-eventbus\";\nimport { onMounted, ref } from \"vue\";\nimport { message } from \"ant-design-vue\";\nimport { changePlanApi, getPlanAllPlans } from \"@/js/apihelper\";\nexport default {\n  __name: 'PlanChangeCom',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const closeSelectCard = () => {\n      bus.emit('closeSelectCard');\n    };\n    onMounted(() => {\n      //获取allYearTargets\n      const allTargetsResult = getPlanAllPlans();\n      allTargetsResult.then(response => {\n        allYearTargets.value = response.data;\n        currentYear.value = new Date().getFullYear();\n        getCurrentYearTargets();\n      }).catch(e => {\n        console.log(e);\n        message.error('获取挑战板数据失败');\n      });\n    });\n    const getCurrentYearTargets = () => {\n      currentYearTargets.value = allYearTargets.value.filter(item => item.year === currentYear.value);\n    };\n    const currentYearTargets = ref([]);\n    const allYearTargets = ref(null);\n    const currentYear = ref(null);\n    const planId = ref(null);\n    const handleUploadChange = info => {\n      if (info.file.status === 'done') {\n        currentYearTargets.value.filter(item => item.planId === Number(planId.value)).forEach(item => {\n          item.planImg = info.file.response;\n          message.success(`文件上传成功，photo值已更改`);\n        });\n      } else if (info.file.status === 'error') {\n        message.error(`${info.file.name} 文件上传失败`);\n      }\n    };\n    const changePlan = () => {\n      currentYearTargets.value.filter(item => item.planId === Number(planId.value)).forEach(item => {\n        const postResult = changePlanApi(item);\n        postResult.then(response => {\n          if (response.data) {\n            message.success('修改成功');\n          } else {\n            message.error('修改失败');\n          }\n        }).catch(e => {\n          console.log(e);\n          message.error('请求失败');\n        });\n      });\n    };\n    const lastYear = () => {\n      planId.value = null;\n      currentYear.value -= 1;\n      getCurrentYearTargets();\n      if (currentYearTargets.value.length < 1) {\n        nextYear();\n        message.warn('前面没有了');\n      }\n    };\n    const nextYear = () => {\n      planId.value = null;\n      currentYear.value += 1;\n      getCurrentYearTargets();\n      if (currentYearTargets.value.length < 1) {\n        lastYear();\n        message.warn('后面没有了');\n      }\n    };\n    const __returned__ = {\n      closeSelectCard,\n      getCurrentYearTargets,\n      currentYearTargets,\n      allYearTargets,\n      currentYear,\n      planId,\n      handleUploadChange,\n      changePlan,\n      lastYear,\n      nextYear,\n      get CloseOutlined() {\n        return CloseOutlined;\n      },\n      get LeftOutlined() {\n        return LeftOutlined;\n      },\n      get RightOutlined() {\n        return RightOutlined;\n      },\n      get UploadOutlined() {\n        return UploadOutlined;\n      },\n      get bus() {\n        return bus;\n      },\n      onMounted,\n      ref,\n      get message() {\n        return message;\n      },\n      get changePlanApi() {\n        return changePlanApi;\n      },\n      get getPlanAllPlans() {\n        return getPlanAllPlans;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["CloseOutlined","LeftOutlined","RightOutlined","UploadOutlined","bus","onMounted","ref","message","changePlanApi","getPlanAllPlans","closeSelectCard","emit","allTargetsResult","then","response","allYearTargets","value","data","currentYear","Date","getFullYear","getCurrentYearTargets","catch","e","console","log","error","currentYearTargets","filter","item","year","planId","handleUploadChange","info","file","status","Number","forEach","planImg","success","name","changePlan","postResult","lastYear","length","nextYear","warn"],"sources":["/Users/ayden/Desktop/FiveCheersBlog/fcweb/src/coms/manager/PlanChangeCom.vue"],"sourcesContent":["<script setup>\nimport {CloseOutlined, LeftOutlined, RightOutlined, UploadOutlined} from '@ant-design/icons-vue'\nimport {bus} from \"vue3-eventbus\";\nimport {onMounted, ref} from \"vue\";\nimport {message} from \"ant-design-vue\";\nimport {changePlanApi, getPlanAllPlans} from \"@/js/apihelper\";\n\nconst closeSelectCard = ()=>{\n  bus.emit('closeSelectCard')\n}\nonMounted(()=>{\n  //获取allYearTargets\n  const allTargetsResult = getPlanAllPlans()\n  allTargetsResult.then(response=>{\n    allYearTargets.value = response.data\n    currentYear.value = new Date().getFullYear()\n    getCurrentYearTargets()\n  }).catch(e=>{\n    console.log(e)\n    message.error('获取挑战板数据失败')\n  })\n})\nconst getCurrentYearTargets = ()=>{\n  currentYearTargets.value = allYearTargets.value.filter(item => item.year === currentYear.value)\n}\nconst currentYearTargets = ref([])\nconst allYearTargets = ref(null)\nconst currentYear = ref(null)\nconst planId = ref(null)\nconst handleUploadChange = (info)=>{\n  if (info.file.status === 'done') {\n    currentYearTargets.value.filter(item => item.planId === Number(planId.value)).forEach(item => {\n      item.planImg = info.file.response\n      message.success(`文件上传成功，photo值已更改`);\n    })\n  } else if (info.file.status === 'error') {\n    message.error(`${info.file.name} 文件上传失败`);\n  }\n}\nconst changePlan = ()=>{\n  currentYearTargets.value.filter(item => item.planId === Number(planId.value)).forEach(item => {\n    const postResult = changePlanApi(item)\n    postResult.then(response=>{\n      if (response.data){\n        message.success('修改成功')\n      }else{\n        message.error('修改失败')\n      }\n    }).catch(e=>{\n      console.log(e)\n      message.error('请求失败')\n    })\n  })\n}\nconst lastYear = ()=>{\n  planId.value = null\n  currentYear.value -= 1\n  getCurrentYearTargets()\n  if (currentYearTargets.value.length <1){\n    nextYear()\n    message.warn('前面没有了')\n  }\n}\nconst nextYear = ()=>{\n  planId.value = null\n  currentYear.value += 1\n  getCurrentYearTargets()\n  if (currentYearTargets.value.length <1){\n    lastYear()\n    message.warn('后面没有了')\n  }\n}\n</script>\n\n<template>\n  <div class=\"select_com_background\">\n    <h2>- 编辑挑战 -</h2>\n    <CloseOutlined @click=\"closeSelectCard()\" class=\"card_cancel_btn\" />\n    <div class=\"select_com_card\">\n      <div class=\"select_card_title\">\n        <LeftOutlined @click=\"lastYear\"/>\n        <h3 style=\"margin-bottom: 0\">{{ currentYear }}</h3>\n        <RightOutlined @click=\"nextYear\"/>\n      </div>\n      <a-collapse v-model:activeKey=\"planId\" accordion>\n        <a-collapse-panel style=\"position: relative\" v-for=\"item in currentYearTargets\" :key=\"item.planId\" :header=\"item.planName\">\n          <div class=\"select_panel_img_container\">\n            <img :src=\"item.planImg\">\n            <div></div>\n          </div>\n          <div class=\"select_com_line\">\n            <h3>名字：</h3>\n            <a-input style=\"width: 180px\" v-model:value=\"item.planName\"/>\n          </div>\n          <div class=\"select_com_line\">\n            <h3>年份：</h3>\n            <a-input style=\"width: 180px\" v-model:value=\"item.year\"/>\n          </div>\n          <div class=\"select_com_line\">\n            <h3>细节：</h3>\n            <a-input style=\"width: 180px\" v-model:value=\"item.planDetail\"/>\n          </div>\n          <div class=\"select_com_line\">\n            <h3>进度：</h3>\n            <a-input style=\"width: 180px\" v-model:value=\"item.planCompleted\"/>\n          </div>\n          <div class=\"select_com_line\">\n            <h3>图片：</h3>\n            <a-input style=\"width: 180px\" v-model:value=\"item.planImg\"/>\n          </div>\n          <a-upload\n              action=\"https://www.yym-free.com/wz/file/defaultUpLoadFile\"\n              @change=\"handleUploadChange\">\n            <a-button style=\"margin-top: 8px\">\n              <upload-outlined></upload-outlined>\n              上传图片\n            </a-button>\n          </a-upload>\n          <div class=\"select_com_line_btn\">\n            <a-button @click=\"changePlan\" type=\"primary\" size=\"large\">确定</a-button>\n          </div>\n        </a-collapse-panel>\n      </a-collapse>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n.select_com_background{\n  position: fixed;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  background: #00000044;\n  animation: fade-in .5s 1;\n}\n.select_com_card{\n  position: absolute;\n  left: 16px;\n  right: 16px;\n  top: 50%;\n  transform: translateY(-50%);\n  max-height: 580px;\n  height: calc(100% - 88px);\n  background: #fff;\n  border-radius: 8px;\n  padding: 16px 12px;\n  overflow-y: scroll;\n  overflow-x: hidden;\n  display: flex;\n  flex-direction: column;\n}\n.select_com_background h2{\n  position: absolute;\n  top: calc(25vh - 145px);\n  left: 50%;\n  transform: translateX(-50%);\n  color: white;\n  letter-spacing: 6px;\n  font-size: 20px;\n  white-space: nowrap;\n}\n.select_card_title{\n  height: 36px;\n  display: flex;\n  align-items: center;\n  justify-content: space-around;\n  margin-bottom: 12px;\n}\n.select_com_line{\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 4px 0;\n}\n.select_com_line h3{\n  font-weight: bold;\n  margin: 0;\n  z-index: 999;\n}\n.select_panel_img_container{\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  background-color: #888;\n  overflow: hidden;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.select_panel_img_container img{\n  min-height: 100%;\n  min-width: 100%;\n}\n.select_panel_img_container div{\n  background-color: #eeeeee88;\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  backdrop-filter: blur(4px);\n}\n::v-deep .ant-collapse-header{\n  z-index: 999;\n}\n.select_com_line_btn{\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 16px 0 8px 0;\n}\n.select_com_line_btn button{\n  width: 160px;\n}\n\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}